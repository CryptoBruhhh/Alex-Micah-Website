<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Item Details</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="logo"><a href="/">PRELAUNCH.MEME</a></div>
    </header>

    <div class="item-details-container">
        <div id="item-banner" class="item-banner">
            <!-- Banner image will go here, styled in CSS -->
        </div>
        <div class="item-content">
            <h1 id="item-name"></h1>
            <img id="item-icon" src="" alt="Item Icon">
            <p id="item-description"></p>
            <div id="item-artwork"></div>
            <p id="item-ticker"></p>
            <p id="item-countdown"></p>
            <p id="item-creator"></p> <!-- New element for creator information -->
        </div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const ticker = params.get('ticker');
    
        function updateCountdown(element, endTime) {
            const interval = setInterval(() => {
                const now = new Date();
                const distance = endTime - now;
    
                if (distance > 0) {
                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                    element.textContent = `Countdown: ${days}d ${hours}h ${minutes}m ${seconds}s`;
                } else {
                    clearInterval(interval);
                    element.textContent = "Countdown: Ended";
                }
            }, 1000);
        }
    
        fetch(`/items/${ticker}`)
            .then(response => response.json())
            .then(item => {
                console.log('Received item data:', JSON.stringify(item, null, 2));
    
                document.getElementById('item-name').textContent = item.name;
                document.getElementById('item-icon').src = `http://localhost:3000/${item.icon}`;
                document.getElementById('item-description').textContent = item.description;
                document.getElementById('item-ticker').textContent = `Ticker: ${item.ticker}`;
    
                // Set up live countdown
                const countdownElement = document.getElementById('item-countdown');
                updateCountdown(countdownElement, new Date(item.endTime));
    
                // Set banner image
                const bannerDiv = document.getElementById('item-banner');
                bannerDiv.style.backgroundImage = `url(http://localhost:3000/${item.banner})`;
                bannerDiv.style.height = '200px';
                bannerDiv.style.width = '100%';
                bannerDiv.style.backgroundSize = 'cover';
    
                // Display artwork images
                const artworkContainer = document.getElementById('item-artwork');
                item.artwork.forEach(art => {
                    const img = document.createElement('img');
                    img.src = `http://localhost:3000/${art}`;
                    img.alt = 'Item Artwork';
                    img.style.width = '100px';
                    img.style.margin = '5px';
                    artworkContainer.appendChild(img);
                });
    
                // Display creator information
                const creatorElement = document.getElementById('item-creator');
                console.log('Creator information:', item.createdBy);
                if (item.createdBy && item.createdBy.username) {
                    creatorElement.textContent = `Created by: ${item.createdBy.username}`;
                } else if (item.createdBy) {
                    creatorElement.textContent = `Created by user with ID: ${item.createdBy}`;
                } else {
                    creatorElement.textContent = 'Creator information not available';
                }
            })
            .catch(error => console.error('Failed to load item details:', error));
    </script>
</body>
</html>